<template>
  <section class="section _PLR">
    <div
      v-if="result === ''"
      class="page loading _dzUq">
      <div class="loading-body _TkUH">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 50 50"
          width="50"
          height="50"
          preserveAspectRatio="xMidYMid meet"
          style="width: 100%; height: 100%; transform: translate3d(0px, 0px, 0px);"
        >
          <defs>
            <clipPath id="__lottie_element_170">
              <rect width="50" height="50" x="0" y="0" />
            </clipPath>
            <clipPath id="__lottie_element_172">
              <path d="M0,0 L100,0 L100,100 L0,100z" />
            </clipPath>
          </defs>
          <g clip-path="url(#__lottie_element_170)">
            <g
              clip-path="url(#__lottie_element_172)"
              transform="matrix(0.5,0,0,0.5,0,0)"
              opacity="1"
              style="display: block;"
            >
              <g
                transform="matrix(1,0,0,0.800000011920929,76.125,129.3050079345703)"
                opacity="1"
                style="display: block;"
              >
                <g opacity="1" transform="matrix(1,0,0,1,-64.10900115966797,-99.52300262451172)">
                  <path
                    fill="rgb(248,100,66)"
                    fill-opacity="1"
                    d=" M2.890500068664551,-32.586002349853516 C2.890500068664551,-32.586002349853516 2.890500068664551,32.586002349853516 2.890500068664551,32.586002349853516 C2.890500068664551,34.18126678466797 1.5952669382095337,35.47650146484375 0,35.47650146484375 C0,35.47650146484375 0,35.47650146484375 0,35.47650146484375 C-1.5952669382095337,35.47650146484375 -2.890500068664551,34.18126678466797 -2.890500068664551,32.586002349853516 C-2.890500068664551,32.586002349853516 -2.890500068664551,-32.586002349853516 -2.890500068664551,-32.586002349853516 C-2.890500068664551,-34.18126678466797 -1.5952669382095337,-35.47650146484375 0,-35.47650146484375 C0,-35.47650146484375 0,-35.47650146484375 0,-35.47650146484375 C1.5952669382095337,-35.47650146484375 2.890500068664551,-34.18126678466797 2.890500068664551,-32.586002349853516z"
                  />
                </g>
              </g>
              <g
                transform="matrix(1,0,0,0.5939115285873413,91.125,109.11123657226562)"
                opacity="1"
                style="display: block;"
              >
                <g opacity="1" transform="matrix(1,0,0,1,-64.10900115966797,-99.52300262451172)">
                  <path
                    fill="rgb(248,100,66)"
                    fill-opacity="1"
                    d=" M2.890500068664551,-32.586002349853516 C2.890500068664551,-32.586002349853516 2.890500068664551,32.586002349853516 2.890500068664551,32.586002349853516 C2.890500068664551,34.18126678466797 1.5952669382095337,35.47650146484375 0,35.47650146484375 C0,35.47650146484375 0,35.47650146484375 0,35.47650146484375 C-1.5952669382095337,35.47650146484375 -2.890500068664551,34.18126678466797 -2.890500068664551,32.586002349853516 C-2.890500068664551,32.586002349853516 -2.890500068664551,-32.586002349853516 -2.890500068664551,-32.586002349853516 C-2.890500068664551,-34.18126678466797 -1.5952669382095337,-35.47650146484375 0,-35.47650146484375 C0,-35.47650146484375 0,-35.47650146484375 0,-35.47650146484375 C1.5952669382095337,-35.47650146484375 2.890500068664551,-34.18126678466797 2.890500068664551,-32.586002349853516z"
                  />
                </g>
              </g>
              <g
                transform="matrix(1,0,0,0.20000000298023224,106.125,70.21900177001953)"
                opacity="1"
                style="display: block;"
              >
                <g opacity="1" transform="matrix(1,0,0,1,-64.10900115966797,-99.52300262451172)">
                  <path
                    fill="rgb(248,100,66)"
                    fill-opacity="1"
                    d=" M2.890500068664551,-32.586002349853516 C2.890500068664551,-32.586002349853516 2.890500068664551,32.586002349853516 2.890500068664551,32.586002349853516 C2.890500068664551,34.18126678466797 1.5952669382095337,35.47650146484375 0,35.47650146484375 C0,35.47650146484375 0,35.47650146484375 0,35.47650146484375 C-1.5952669382095337,35.47650146484375 -2.890500068664551,34.18126678466797 -2.890500068664551,32.586002349853516 C-2.890500068664551,32.586002349853516 -2.890500068664551,-32.586002349853516 -2.890500068664551,-32.586002349853516 C-2.890500068664551,-34.18126678466797 -1.5952669382095337,-35.47650146484375 0,-35.47650146484375 C0,-35.47650146484375 0,-35.47650146484375 0,-35.47650146484375 C1.5952669382095337,-35.47650146484375 2.890500068664551,-34.18126678466797 2.890500068664551,-32.586002349853516z"
                  />
                </g>
              </g>
              <g
                transform="matrix(1,0,0,0.800000011920929,151.125,129.3050079345703)"
                opacity="1"
                style="display: block;"
              >
                <g opacity="1" transform="matrix(1,0,0,1,-64.10900115966797,-99.52300262451172)">
                  <path
                    fill="rgb(248,100,66)"
                    fill-opacity="1"
                    d=" M2.890500068664551,-32.586002349853516 C2.890500068664551,-32.586002349853516 2.890500068664551,32.586002349853516 2.890500068664551,32.586002349853516 C2.890500068664551,34.18126678466797 1.5952669382095337,35.47650146484375 0,35.47650146484375 C0,35.47650146484375 0,35.47650146484375 0,35.47650146484375 C-1.5952669382095337,35.47650146484375 -2.890500068664551,34.18126678466797 -2.890500068664551,32.586002349853516 C-2.890500068664551,32.586002349853516 -2.890500068664551,-32.586002349853516 -2.890500068664551,-32.586002349853516 C-2.890500068664551,-34.18126678466797 -1.5952669382095337,-35.47650146484375 0,-35.47650146484375 C0,-35.47650146484375 0,-35.47650146484375 0,-35.47650146484375 C1.5952669382095337,-35.47650146484375 2.890500068664551,-34.18126678466797 2.890500068664551,-32.586002349853516z"
                  />
                </g>
              </g>
              <g
                transform="matrix(1,0,0,0.5939115285873413,136.125,109.11123657226562)"
                opacity="1"
                style="display: block;"
              >
                <g opacity="1" transform="matrix(1,0,0,1,-64.10900115966797,-99.52300262451172)">
                  <path
                    fill="rgb(248,100,66)"
                    fill-opacity="1"
                    d=" M2.890500068664551,-32.586002349853516 C2.890500068664551,-32.586002349853516 2.890500068664551,32.586002349853516 2.890500068664551,32.586002349853516 C2.890500068664551,34.18126678466797 1.5952669382095337,35.47650146484375 0,35.47650146484375 C0,35.47650146484375 0,35.47650146484375 0,35.47650146484375 C-1.5952669382095337,35.47650146484375 -2.890500068664551,34.18126678466797 -2.890500068664551,32.586002349853516 C-2.890500068664551,32.586002349853516 -2.890500068664551,-32.586002349853516 -2.890500068664551,-32.586002349853516 C-2.890500068664551,-34.18126678466797 -1.5952669382095337,-35.47650146484375 0,-35.47650146484375 C0,-35.47650146484375 0,-35.47650146484375 0,-35.47650146484375 C1.5952669382095337,-35.47650146484375 2.890500068664551,-34.18126678466797 2.890500068664551,-32.586002349853516z"
                  />
                </g>
              </g>
              <g
                transform="matrix(1,0,0,0.20000000298023224,121.125,70.21900177001953)"
                opacity="1"
                style="display: block;"
              >
                <g opacity="1" transform="matrix(1,0,0,1,-64.10900115966797,-99.52300262451172)">
                  <path
                    fill="rgb(248,100,66)"
                    fill-opacity="1"
                    d=" M2.890500068664551,-32.586002349853516 C2.890500068664551,-32.586002349853516 2.890500068664551,32.586002349853516 2.890500068664551,32.586002349853516 C2.890500068664551,34.18126678466797 1.5952669382095337,35.47650146484375 0,35.47650146484375 C0,35.47650146484375 0,35.47650146484375 0,35.47650146484375 C-1.5952669382095337,35.47650146484375 -2.890500068664551,34.18126678466797 -2.890500068664551,32.586002349853516 C-2.890500068664551,32.586002349853516 -2.890500068664551,-32.586002349853516 -2.890500068664551,-32.586002349853516 C-2.890500068664551,-34.18126678466797 -1.5952669382095337,-35.47650146484375 0,-35.47650146484375 C0,-35.47650146484375 0,-35.47650146484375 0,-35.47650146484375 C1.5952669382095337,-35.47650146484375 2.890500068664551,-34.18126678466797 2.890500068664551,-32.586002349853516z"
                  />
                </g>
              </g>
            </g>
          </g>
        </svg>
      </div>
      <p class="tc tip _dzUq">页面加载中...</p>
    </div>
    <div v-else class="scrollWrapper" style="height: 100%;">
      <div class="content _ld" style="width: 100%; height: 100%; box-sizing: border-box;">
        <section class="listView _ld" style="background: rgb(255, 255, 255);">
          <ul class="_ld">
            <a class="resultItem userItem _PLR" 
            v-for="(value,index1) in userView"
            :key="index1">
              <img
                class="avatar _PLR"
                :src="value.userInfo.smallPic"
              />
              <div class="userInfo _PLR">
                <p class="userTitle _PLR">
                  <span class="text _PLR">{{value.userInfo.nickname}}</span>
                  <svg class="icon grade _PLR">
                    <use xlink:href="#icon-individual_blue_V15" />
                  </svg>
                </p>
                <p class="userCountInfo _PLR">
                  <i class="xm-icon iconCount _PLR icon-album"></i>
                  <span class="userCount _PLR">{{value.statCountInfo.albumCount}}</span>
                  <i class="xm-icon iconCount _PLR icon-sound"></i>
                  <span class="userCount _PLR">{{value.userInfo.tracks_counts}}</span>
                  <i class="xm-icon iconCount _PLR icon-user"></i>
                  <span class="userCount _PLR">{{value.userInfo.followers_counts}}</span>
                </p>
              </div>
            </a>
          </ul>
        </section>
      </div>
    </div>
  </section>
</template>

<script>
import { get } from "utils/http";
import BScroll from "better-scroll";
import { async } from 'q';
export default {
  data() {
    return {
      userView: "",
      albumView: "",
      trackView: "",
      specialView: "",
      others: [],
      keyword: "",
      pageNo:1,
      total:0,
      pageSize:0,
      result:''
    };
  },
  props:['bScroll'],
  async mounted() {
    let req = /[^\/](\w+)/g;
    this.types = this.$route.path.match(req)[1];

    let message = this.$route.query.keyword;
    this.keyword = this.$route.query.keyword;
    let result = await get({
      url: `/ajax/m-revision/page/search?kw=${message}&core=all&page=1&rows=10`
    });
    this.result = result
    this.userView = result.data.userViews.users;
    // this.albumView = result.data.albumViews.albums;
    // this.trackView = result.data.trackViews.tracks;
    // this.specialView = result.data.specialViews.specials;
    this.total = result.data.userViews.total
    this.pageSize = result.data.userViews.pageSize
    let other = await get({
      url: `/ajax/m-revision/page/search/recommendSearch?kw=${message}`
    })
    this.others = other.data;

    this.bScroll.on('pullingUp',async ()=>{
      console.log(0);
      console.log(this.pageNo,this.pageSize,this.total);
      if(this.pageNo< Math.ceil(this.total/this.pageSize)){
        this.pageNo++
        let result = await get({
          url: `/ajax/m-revision/page/search?kw=${message}&core=all&page=${this.pageNo}&rows=10`
        })
        this.$options.getData.call(this,result)

        await this.$nextTick()
        this.bScroll.refresh()
      }
      this.bScroll.finishPullUp()
    })
    
  },
 
  getData(result){
    this.userView = [
      ...this.userView,
      ...result.data.userViews.users
    ]
  }
  
};
</script>

<style>
</style>