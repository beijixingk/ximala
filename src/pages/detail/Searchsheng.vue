<template>
  <section class="section _PLR">
    <div
      v-if="result===''"
      class="page loading _dzUq">
      <div class="loading-body _TkUH">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 50 50"
          width="50"
          height="50"
          preserveAspectRatio="xMidYMid meet"
          style="width: 100%; height: 100%; transform: translate3d(0px, 0px, 0px);"
        >
          <defs>
            <clipPath id="__lottie_element_170">
              <rect width="50" height="50" x="0" y="0" />
            </clipPath>
            <clipPath id="__lottie_element_172">
              <path d="M0,0 L100,0 L100,100 L0,100z" />
            </clipPath>
          </defs>
          <g clip-path="url(#__lottie_element_170)">
            <g
              clip-path="url(#__lottie_element_172)"
              transform="matrix(0.5,0,0,0.5,0,0)"
              opacity="1"
              style="display: block;"
            >
              <g
                transform="matrix(1,0,0,0.800000011920929,76.125,129.3050079345703)"
                opacity="1"
                style="display: block;"
              >
                <g opacity="1" transform="matrix(1,0,0,1,-64.10900115966797,-99.52300262451172)">
                  <path
                    fill="rgb(248,100,66)"
                    fill-opacity="1"
                    d=" M2.890500068664551,-32.586002349853516 C2.890500068664551,-32.586002349853516 2.890500068664551,32.586002349853516 2.890500068664551,32.586002349853516 C2.890500068664551,34.18126678466797 1.5952669382095337,35.47650146484375 0,35.47650146484375 C0,35.47650146484375 0,35.47650146484375 0,35.47650146484375 C-1.5952669382095337,35.47650146484375 -2.890500068664551,34.18126678466797 -2.890500068664551,32.586002349853516 C-2.890500068664551,32.586002349853516 -2.890500068664551,-32.586002349853516 -2.890500068664551,-32.586002349853516 C-2.890500068664551,-34.18126678466797 -1.5952669382095337,-35.47650146484375 0,-35.47650146484375 C0,-35.47650146484375 0,-35.47650146484375 0,-35.47650146484375 C1.5952669382095337,-35.47650146484375 2.890500068664551,-34.18126678466797 2.890500068664551,-32.586002349853516z"
                  />
                </g>
              </g>
              <g
                transform="matrix(1,0,0,0.5939115285873413,91.125,109.11123657226562)"
                opacity="1"
                style="display: block;"
              >
                <g opacity="1" transform="matrix(1,0,0,1,-64.10900115966797,-99.52300262451172)">
                  <path
                    fill="rgb(248,100,66)"
                    fill-opacity="1"
                    d=" M2.890500068664551,-32.586002349853516 C2.890500068664551,-32.586002349853516 2.890500068664551,32.586002349853516 2.890500068664551,32.586002349853516 C2.890500068664551,34.18126678466797 1.5952669382095337,35.47650146484375 0,35.47650146484375 C0,35.47650146484375 0,35.47650146484375 0,35.47650146484375 C-1.5952669382095337,35.47650146484375 -2.890500068664551,34.18126678466797 -2.890500068664551,32.586002349853516 C-2.890500068664551,32.586002349853516 -2.890500068664551,-32.586002349853516 -2.890500068664551,-32.586002349853516 C-2.890500068664551,-34.18126678466797 -1.5952669382095337,-35.47650146484375 0,-35.47650146484375 C0,-35.47650146484375 0,-35.47650146484375 0,-35.47650146484375 C1.5952669382095337,-35.47650146484375 2.890500068664551,-34.18126678466797 2.890500068664551,-32.586002349853516z"
                  />
                </g>
              </g>
              <g
                transform="matrix(1,0,0,0.20000000298023224,106.125,70.21900177001953)"
                opacity="1"
                style="display: block;"
              >
                <g opacity="1" transform="matrix(1,0,0,1,-64.10900115966797,-99.52300262451172)">
                  <path
                    fill="rgb(248,100,66)"
                    fill-opacity="1"
                    d=" M2.890500068664551,-32.586002349853516 C2.890500068664551,-32.586002349853516 2.890500068664551,32.586002349853516 2.890500068664551,32.586002349853516 C2.890500068664551,34.18126678466797 1.5952669382095337,35.47650146484375 0,35.47650146484375 C0,35.47650146484375 0,35.47650146484375 0,35.47650146484375 C-1.5952669382095337,35.47650146484375 -2.890500068664551,34.18126678466797 -2.890500068664551,32.586002349853516 C-2.890500068664551,32.586002349853516 -2.890500068664551,-32.586002349853516 -2.890500068664551,-32.586002349853516 C-2.890500068664551,-34.18126678466797 -1.5952669382095337,-35.47650146484375 0,-35.47650146484375 C0,-35.47650146484375 0,-35.47650146484375 0,-35.47650146484375 C1.5952669382095337,-35.47650146484375 2.890500068664551,-34.18126678466797 2.890500068664551,-32.586002349853516z"
                  />
                </g>
              </g>
              <g
                transform="matrix(1,0,0,0.800000011920929,151.125,129.3050079345703)"
                opacity="1"
                style="display: block;"
              >
                <g opacity="1" transform="matrix(1,0,0,1,-64.10900115966797,-99.52300262451172)">
                  <path
                    fill="rgb(248,100,66)"
                    fill-opacity="1"
                    d=" M2.890500068664551,-32.586002349853516 C2.890500068664551,-32.586002349853516 2.890500068664551,32.586002349853516 2.890500068664551,32.586002349853516 C2.890500068664551,34.18126678466797 1.5952669382095337,35.47650146484375 0,35.47650146484375 C0,35.47650146484375 0,35.47650146484375 0,35.47650146484375 C-1.5952669382095337,35.47650146484375 -2.890500068664551,34.18126678466797 -2.890500068664551,32.586002349853516 C-2.890500068664551,32.586002349853516 -2.890500068664551,-32.586002349853516 -2.890500068664551,-32.586002349853516 C-2.890500068664551,-34.18126678466797 -1.5952669382095337,-35.47650146484375 0,-35.47650146484375 C0,-35.47650146484375 0,-35.47650146484375 0,-35.47650146484375 C1.5952669382095337,-35.47650146484375 2.890500068664551,-34.18126678466797 2.890500068664551,-32.586002349853516z"
                  />
                </g>
              </g>
              <g
                transform="matrix(1,0,0,0.5939115285873413,136.125,109.11123657226562)"
                opacity="1"
                style="display: block;"
              >
                <g opacity="1" transform="matrix(1,0,0,1,-64.10900115966797,-99.52300262451172)">
                  <path
                    fill="rgb(248,100,66)"
                    fill-opacity="1"
                    d=" M2.890500068664551,-32.586002349853516 C2.890500068664551,-32.586002349853516 2.890500068664551,32.586002349853516 2.890500068664551,32.586002349853516 C2.890500068664551,34.18126678466797 1.5952669382095337,35.47650146484375 0,35.47650146484375 C0,35.47650146484375 0,35.47650146484375 0,35.47650146484375 C-1.5952669382095337,35.47650146484375 -2.890500068664551,34.18126678466797 -2.890500068664551,32.586002349853516 C-2.890500068664551,32.586002349853516 -2.890500068664551,-32.586002349853516 -2.890500068664551,-32.586002349853516 C-2.890500068664551,-34.18126678466797 -1.5952669382095337,-35.47650146484375 0,-35.47650146484375 C0,-35.47650146484375 0,-35.47650146484375 0,-35.47650146484375 C1.5952669382095337,-35.47650146484375 2.890500068664551,-34.18126678466797 2.890500068664551,-32.586002349853516z"
                  />
                </g>
              </g>
              <g
                transform="matrix(1,0,0,0.20000000298023224,121.125,70.21900177001953)"
                opacity="1"
                style="display: block;"
              >
                <g opacity="1" transform="matrix(1,0,0,1,-64.10900115966797,-99.52300262451172)">
                  <path
                    fill="rgb(248,100,66)"
                    fill-opacity="1"
                    d=" M2.890500068664551,-32.586002349853516 C2.890500068664551,-32.586002349853516 2.890500068664551,32.586002349853516 2.890500068664551,32.586002349853516 C2.890500068664551,34.18126678466797 1.5952669382095337,35.47650146484375 0,35.47650146484375 C0,35.47650146484375 0,35.47650146484375 0,35.47650146484375 C-1.5952669382095337,35.47650146484375 -2.890500068664551,34.18126678466797 -2.890500068664551,32.586002349853516 C-2.890500068664551,32.586002349853516 -2.890500068664551,-32.586002349853516 -2.890500068664551,-32.586002349853516 C-2.890500068664551,-34.18126678466797 -1.5952669382095337,-35.47650146484375 0,-35.47650146484375 C0,-35.47650146484375 0,-35.47650146484375 0,-35.47650146484375 C1.5952669382095337,-35.47650146484375 2.890500068664551,-34.18126678466797 2.890500068664551,-32.586002349853516z"
                  />
                </g>
              </g>
            </g>
          </g>
        </svg>
      </div>
      <p class="tc tip _dzUq">页面加载中...</p>
    </div>
    <div else class="scrollWrapper" style="height: 100%;">
      <div class="content _ld" style="width: 100%; height: 100%; box-sizing: border-box;">
        <section class="listView _ld" style="background: rgb(255, 255, 255);">
          <ul class="_ld">
            <li
              class="resultItem _PLR"
              @click="detailClick(track.trackInfo.album_id,track.trackInfo.id)"
              v-for="(track,index3) in trackView"
              :key="index3"
            >
              <div class="itemWrapper _PLR">
                <div class="xm-track _GGog">
                  <a class="xm-track__wrap _GGog" style="padding: 0px;">
                    <div class="xm-track__cover fl rel _GGog" style="width: 50px; height: 50px;">
                      <img :src="track.trackInfo.cover_path" style="width: 100%; height: 100%;" />
                      <span class="play-btn-wrapper _GGog">
                        <svg class="icon play-btn _GGog">
                          <use xlink:href="#icon-bofang-bai" />
                          <svg id="icon-bofang-bai" viewBox="0 0 1024 1024">
                            <path
                              d="M890.744555 404.898323L293.493526 26.153768c-94.686139-65.551942-218.506474 0-218.506474 109.253237v750.205561c0 109.253237 123.820335 174.805179 218.506474 109.253237l597.251029-371.461006c80.119041-50.984844 80.119041-167.52163 0-218.506474z"
                              fill="#FFFFFF"
                            />
                          </svg>
                        </svg>
                      </span>
                    </div>
                    <div class="xm-track__content _GGog">
                      <h3
                        class="xm-track__title ellipsis-2 _GGog"
                        style="line-height: 22px; color: rgb(64, 64, 76);"
                      >{{track.trackInfo.title}}</h3>
                      <p class="xm-track__desc _GGog">
                        <span class="xm-track__info _GGog">
                          <i class="xm-icon icon-ic_play" style="font-size: 10px;"></i>
                          &nbsp;{{track.trackInfo.count_play}}
                        </span>
                        <span class="xm-track__info _GGog">
                          <i class="xm-icon icon-commentlight"></i>
                          &nbsp;{{track.trackInfo.count_comment}}
                        </span>
                        <span class="xm-track__info _GGog">
                          <i class="xm-icon icon-timelight"></i>&nbsp;04:06
                        </span>
                        <span class="xm-track__info _GGog"></span>
                      </p>
                    </div>
                  </a>
                </div>
              </div>
            </li>
          </ul>
        </section>
      </div>
    </div>
  </section>
</template>

<script>
import { get } from "utils/http";
import BScroll from "better-scroll";
import { async } from "q";
export default {
  data() {
    return {
      userView: "",
      albumView: "",
      trackView: "",
      specialView: "",
      others: [],
      keyword: "",
      pageNo: 1,
      total: 0,
      pageSize: 0,
      result:''
    };
  },
  props: ["bScroll"],
  methods: {
    handleClick(id) {
      // console.log(id);
      this.$router.push(`/Detail/${id}`);
    },
    detailClick(id, idd) {
      // console.log(id);
      this.$router.push(`/Play/${id}/${idd}`);
    }
  },
  async mounted() {
    let req = /[^\/](\w+)/g;
    this.types = this.$route.path.match(req)[1];

    let message = this.$route.query.keyword;
    this.keyword = this.$route.query.keyword;
    let result = await get({
      url: `/ajax/m-revision/page/search?kw=${message}&core=track&page=1&rows=10`
    });
    this.result = result
    // this.userView = result.data.userViews.users;
    // this.albumView = result.data.albumViews.albums;
    this.trackView = result.data.trackViews.tracks;
    // this.specialView = result.data.specialViews.specials;
    this.total = result.data.trackViews.total;
    this.pageSize = result.data.trackViews.pageSize;

    this.bScroll.on("pullingUp", async () => {
      console.log(0);
      console.log(this.pageNo, this.pageSize, this.total);
      if (this.pageNo < Math.ceil(this.total / this.pageSize)) {
        this.pageNo++;
        let result = await get({
          url: `/ajax/m-revision/page/search?kw=${message}&core=track&page=${this.pageNo}&rows=10`
        });
        this.$options.getData.call(this, result);

        await this.$nextTick();
        this.bScroll.refresh();
      }
      this.bScroll.finishPullUp();
    });
  },

  getData(result) {
    this.trackView = [...this.trackView, ...result.data.trackViews.tracks];
  }
};
</script>

<style lang="stylus" scoped>

  
</style>