<template>
  <div>
     <div v-if="moduleData===[] || moreData===[] || tabData===[]" class="page loading _dzUq">
      <div class="loading-body _TkUH">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 50 50"
          width="50"
          height="50"
          preserveAspectRatio="xMidYMid meet"
          style="width: 100%; height: 100%; transform: translate3d(0px, 0px, 0px);"
        >
          <defs>
            <clipPath id="__lottie_element_170">
              <rect width="50" height="50" x="0" y="0" />
            </clipPath>
            <clipPath id="__lottie_element_172">
              <path d="M0,0 L100,0 L100,100 L0,100z" />
            </clipPath>
          </defs>
          <g clip-path="url(#__lottie_element_170)">
            <g
              clip-path="url(#__lottie_element_172)"
              transform="matrix(0.5,0,0,0.5,0,0)"
              opacity="1"
              style="display: block;"
            >
              <g
                transform="matrix(1,0,0,0.800000011920929,76.125,129.3050079345703)"
                opacity="1"
                style="display: block;"
              >
                <g opacity="1" transform="matrix(1,0,0,1,-64.10900115966797,-99.52300262451172)">
                  <path
                    fill="rgb(248,100,66)"
                    fill-opacity="1"
                    d=" M2.890500068664551,-32.586002349853516 C2.890500068664551,-32.586002349853516 2.890500068664551,32.586002349853516 2.890500068664551,32.586002349853516 C2.890500068664551,34.18126678466797 1.5952669382095337,35.47650146484375 0,35.47650146484375 C0,35.47650146484375 0,35.47650146484375 0,35.47650146484375 C-1.5952669382095337,35.47650146484375 -2.890500068664551,34.18126678466797 -2.890500068664551,32.586002349853516 C-2.890500068664551,32.586002349853516 -2.890500068664551,-32.586002349853516 -2.890500068664551,-32.586002349853516 C-2.890500068664551,-34.18126678466797 -1.5952669382095337,-35.47650146484375 0,-35.47650146484375 C0,-35.47650146484375 0,-35.47650146484375 0,-35.47650146484375 C1.5952669382095337,-35.47650146484375 2.890500068664551,-34.18126678466797 2.890500068664551,-32.586002349853516z"
                  />
                </g>
              </g>
              <g
                transform="matrix(1,0,0,0.5939115285873413,91.125,109.11123657226562)"
                opacity="1"
                style="display: block;"
              >
                <g opacity="1" transform="matrix(1,0,0,1,-64.10900115966797,-99.52300262451172)">
                  <path
                    fill="rgb(248,100,66)"
                    fill-opacity="1"
                    d=" M2.890500068664551,-32.586002349853516 C2.890500068664551,-32.586002349853516 2.890500068664551,32.586002349853516 2.890500068664551,32.586002349853516 C2.890500068664551,34.18126678466797 1.5952669382095337,35.47650146484375 0,35.47650146484375 C0,35.47650146484375 0,35.47650146484375 0,35.47650146484375 C-1.5952669382095337,35.47650146484375 -2.890500068664551,34.18126678466797 -2.890500068664551,32.586002349853516 C-2.890500068664551,32.586002349853516 -2.890500068664551,-32.586002349853516 -2.890500068664551,-32.586002349853516 C-2.890500068664551,-34.18126678466797 -1.5952669382095337,-35.47650146484375 0,-35.47650146484375 C0,-35.47650146484375 0,-35.47650146484375 0,-35.47650146484375 C1.5952669382095337,-35.47650146484375 2.890500068664551,-34.18126678466797 2.890500068664551,-32.586002349853516z"
                  />
                </g>
              </g>
              <g
                transform="matrix(1,0,0,0.20000000298023224,106.125,70.21900177001953)"
                opacity="1"
                style="display: block;"
              >
                <g opacity="1" transform="matrix(1,0,0,1,-64.10900115966797,-99.52300262451172)">
                  <path
                    fill="rgb(248,100,66)"
                    fill-opacity="1"
                    d=" M2.890500068664551,-32.586002349853516 C2.890500068664551,-32.586002349853516 2.890500068664551,32.586002349853516 2.890500068664551,32.586002349853516 C2.890500068664551,34.18126678466797 1.5952669382095337,35.47650146484375 0,35.47650146484375 C0,35.47650146484375 0,35.47650146484375 0,35.47650146484375 C-1.5952669382095337,35.47650146484375 -2.890500068664551,34.18126678466797 -2.890500068664551,32.586002349853516 C-2.890500068664551,32.586002349853516 -2.890500068664551,-32.586002349853516 -2.890500068664551,-32.586002349853516 C-2.890500068664551,-34.18126678466797 -1.5952669382095337,-35.47650146484375 0,-35.47650146484375 C0,-35.47650146484375 0,-35.47650146484375 0,-35.47650146484375 C1.5952669382095337,-35.47650146484375 2.890500068664551,-34.18126678466797 2.890500068664551,-32.586002349853516z"
                  />
                </g>
              </g>
              <g
                transform="matrix(1,0,0,0.800000011920929,151.125,129.3050079345703)"
                opacity="1"
                style="display: block;"
              >
                <g opacity="1" transform="matrix(1,0,0,1,-64.10900115966797,-99.52300262451172)">
                  <path
                    fill="rgb(248,100,66)"
                    fill-opacity="1"
                    d=" M2.890500068664551,-32.586002349853516 C2.890500068664551,-32.586002349853516 2.890500068664551,32.586002349853516 2.890500068664551,32.586002349853516 C2.890500068664551,34.18126678466797 1.5952669382095337,35.47650146484375 0,35.47650146484375 C0,35.47650146484375 0,35.47650146484375 0,35.47650146484375 C-1.5952669382095337,35.47650146484375 -2.890500068664551,34.18126678466797 -2.890500068664551,32.586002349853516 C-2.890500068664551,32.586002349853516 -2.890500068664551,-32.586002349853516 -2.890500068664551,-32.586002349853516 C-2.890500068664551,-34.18126678466797 -1.5952669382095337,-35.47650146484375 0,-35.47650146484375 C0,-35.47650146484375 0,-35.47650146484375 0,-35.47650146484375 C1.5952669382095337,-35.47650146484375 2.890500068664551,-34.18126678466797 2.890500068664551,-32.586002349853516z"
                  />
                </g>
              </g>
              <g
                transform="matrix(1,0,0,0.5939115285873413,136.125,109.11123657226562)"
                opacity="1"
                style="display: block;"
              >
                <g opacity="1" transform="matrix(1,0,0,1,-64.10900115966797,-99.52300262451172)">
                  <path
                    fill="rgb(248,100,66)"
                    fill-opacity="1"
                    d=" M2.890500068664551,-32.586002349853516 C2.890500068664551,-32.586002349853516 2.890500068664551,32.586002349853516 2.890500068664551,32.586002349853516 C2.890500068664551,34.18126678466797 1.5952669382095337,35.47650146484375 0,35.47650146484375 C0,35.47650146484375 0,35.47650146484375 0,35.47650146484375 C-1.5952669382095337,35.47650146484375 -2.890500068664551,34.18126678466797 -2.890500068664551,32.586002349853516 C-2.890500068664551,32.586002349853516 -2.890500068664551,-32.586002349853516 -2.890500068664551,-32.586002349853516 C-2.890500068664551,-34.18126678466797 -1.5952669382095337,-35.47650146484375 0,-35.47650146484375 C0,-35.47650146484375 0,-35.47650146484375 0,-35.47650146484375 C1.5952669382095337,-35.47650146484375 2.890500068664551,-34.18126678466797 2.890500068664551,-32.586002349853516z"
                  />
                </g>
              </g>
              <g
                transform="matrix(1,0,0,0.20000000298023224,121.125,70.21900177001953)"
                opacity="1"
                style="display: block;"
              >
                <g opacity="1" transform="matrix(1,0,0,1,-64.10900115966797,-99.52300262451172)">
                  <path
                    fill="rgb(248,100,66)"
                    fill-opacity="1"
                    d=" M2.890500068664551,-32.586002349853516 C2.890500068664551,-32.586002349853516 2.890500068664551,32.586002349853516 2.890500068664551,32.586002349853516 C2.890500068664551,34.18126678466797 1.5952669382095337,35.47650146484375 0,35.47650146484375 C0,35.47650146484375 0,35.47650146484375 0,35.47650146484375 C-1.5952669382095337,35.47650146484375 -2.890500068664551,34.18126678466797 -2.890500068664551,32.586002349853516 C-2.890500068664551,32.586002349853516 -2.890500068664551,-32.586002349853516 -2.890500068664551,-32.586002349853516 C-2.890500068664551,-34.18126678466797 -1.5952669382095337,-35.47650146484375 0,-35.47650146484375 C0,-35.47650146484375 0,-35.47650146484375 0,-35.47650146484375 C1.5952669382095337,-35.47650146484375 2.890500068664551,-34.18126678466797 2.890500068664551,-32.586002349853516z"
                  />
                </g>
              </g>
            </g>
          </g>
        </svg>
      </div>
      <p class="tc tip _dzUq">页面加载中...</p>
    </div>
    <!-- <Indexswiper class="indexswiper" :tabswiper="tabData.focusImages"></Indexswiper> -->
     <div class="swiper"  v-if="name !== 'xiangsheng' && tabData.focusImages!==[] && name !== 'yinyue' && name !== 'renwen' && name !== 'lishi'">
      <swiper :options="swiperOption" class="banner">
        <swiper-slide class="item" v-for="(ivalue,is) in tabData.focusImages"
      :key="is">
            <img  @click="handleClick(ivalue.adFocusPictureDetail.realLink)" :src="ivalue.adFocusPictureDetail.cover" alt="">
        </swiper-slide>
       
      </swiper>
    </div>
    <div class="xm-slider _kIb" v-else-if="name === 'xiangsheng'">
      <img
        alt="轮播图"
        src="http://fdfs.xmcdn.com/group68/M03/CD/55/wKgMbl3TWXvgSDb1AAIofZsZpss510.jpg"
        class="_kIb"
        @click="handleClick(tabData.focusImages[0].adFocusPictureDetail.realLink)"
      />
    </div>
    <div v-else>

    </div>
    <Catewrap :cate="cates"></Catewrap>
    <bannerimg></bannerimg>
    <div class="_kIb" v-for="(module,index) in moduleData" :key="index">
      <div class="album-title _kIb">{{module.moduleInfo.displayName}}</div>
      <div class="album-ver _kIb">
        <section
          class="album-wrap _Uf"
          style="margin: 0px 3px;"
          v-for="(items,index2) in module.albumBriefDetailInfos.slice(0,3)"
          :key="index2"
          @click="detailClick(items.id)"
        >
          <a class="album-container _Uf">
            <div class="album-cover rel _Uf" style="padding-bottom: 100%; height: 0px;">
              <img
                class="img-cover _Uf"
                :src="'//imagev2.xmcdn.com/'+items.albumInfo.cover+'!op_type=3&amp;columns=144&amp;rows=144&amp;magick=webp'"
              />
              <div class="album-cover-panel _Uf">
                <div class="abs info-bar ellipsis home-bar _kIb _Uf">
                  <svg width="20" height="20" class="icon">
                    <use xlink:href="#icon-play_ic_shound">
                      <svg id="icon-play_ic_shound" viewBox="0 0 1024 1024">
                        <path
                          d="M512 512m-353.28 0a353.28 353.28 0 1 0 706.56 0 353.28 353.28 0 1 0-706.56 0Z"
                          opacity=".4"
                        />
                        <path
                          d="M512 896C302.08 896 128 721.92 128 512S302.08 128 512 128 896 302.08 896 512 721.92 896 512 896z m0-706.56C337.92 189.44 194.56 332.8 194.56 506.88s143.36 317.44 317.44 317.44 317.44-143.36 317.44-317.44-143.36-317.44-317.44-317.44z"
                          fill="#FFFFFF"
                          opacity=".4"
                        />
                        <path
                          d="M471.04 634.88c5.12 0 10.24 0 10.24-5.12l158.72-97.28c5.12-5.12 15.36-10.24 15.36-20.48s-5.12-15.36-10.24-20.48l-153.6-97.28c-5.12-5.12-10.24-5.12-20.48-5.12s-20.48 10.24-20.48 25.6V614.4c0 10.24 10.24 20.48 20.48 20.48z"
                          fill="#FFFFFF"
                        />
                      </svg>
                    </use>
                  </svg>
                  {{items.statCountInfo.playCount}}
                </div>
              </div>
            </div>
            <div class="album-desc _Uf">
              <p class="ellipsis-2 _Uf">{{items.albumInfo.title}}</p>
            </div>
          </a>
        </section>
      </div>
      <div class="album-hor _kIb" v-if="(module.albumBriefDetailInfos.length) > 3">
        <a
          v-for="(items,index2) in module.albumBriefDetailInfos.slice(3)"
          :key="index2"
          @click="detailClick(items.id)"
        >
          <div class="xm-album clearfix _8vVq"
          
          >
            <div
              class="xm-album-cover rel cover cover _8vVq _9m"
              style="width: 94px; height: 94px;"
            >
              <img
                class="cover-image _8vVq"
                :alt="items.albumInfo.title"
                :src="'//imagev2.xmcdn.com/'+items.albumInfo.cover+'!op_type=3&amp;columns=144&amp;rows=144&amp;magick=webp'"
              />
              <div class="xm-album-cover__wrap _9m">
                <div class="mask _9m"></div>
                <div class="play-btn _9m"></div>
              </div>
            </div>
            <div class="content _8vVq">
              <h3
                class="xm-album__title txt-1 ellipsis _8vVq"
                style="color: black;"
              >{{items.albumInfo.title}}</h3>
              <p
                class="xm-album__subtitle c9 ellipsis-2 _8vVq"
                style="height: 34px;"
              >{{items.albumInfo.shortIntro}}</p>
              <div class="xm-album__info c9 _8vVq">
                <span class="count _8vVq">
                  <i class="xm-icon icon-sound"></i>
                  &nbsp; {{items.statCountInfo.trackCount}}
                </span>
                <span class="count _8vVq">
                  <i class="xm-icon icon-data"></i>
                  &nbsp; {{items.statCountInfo.playCount}}
                </span>
              </div>
            </div>
          </div>
        </a>
      </div>
    </div>
    <div class="bottom-list _o2CY">
      <p class="album-title _o2CY">更多推荐</p>
      <div class="scrollWrapper" style="height: 100%;">
        <div class="content _ld">
          <section class="listView _ld">
            <ul class="_ld">
              <a  v-for="(md,indexm) in moreData"
              :key="indexm"
              @click="detailClick(md.data.id)"
              >
                <div class="xm-album clearfix _8vVq">
                  <div
                    class="xm-album-cover rel cover cover _8vVq _9m"
                    style="width: 94px; height: 94px;"
                  >
                    <img
                      class="cover-image _8vVq"
                      :alt="md.data.albumInfo.title"
                      :src="'//imagev2.xmcdn.com/'+md.data.albumInfo.cover+'!op_type=3&amp;columns=144&amp;rows=144&amp;magick=webp'"
                    />
                    <div class="xm-album-cover__wrap _9m">
                      <div class="mask _9m"></div>
                      <div class="play-btn _9m"></div>
                    </div>
                  </div>
                  <div class="content _8vVq">
                    <h3 class="xm-album__title txt-1 ellipsis _8vVq" style="color: black;">{{md.data.albumInfo.title}}</h3>
                    <p
                      class="xm-album__subtitle c9 ellipsis-2 _8vVq"
                      style="height: 34px;"
                    >{{md.data.albumInfo.customTitle}}</p>
                    <div class="xm-album__info c9 _8vVq">
                      <span class="count _8vVq">
                        <i class="xm-icon icon-sound"></i>&nbsp; 197
                      </span>
                      <span class="count _8vVq">
                        <i class="xm-icon icon-data"></i>&nbsp; {{md.data.statCountInfo.playCount}}
                      </span>
                    </div>
                  </div>
                </div>
              </a>
            </ul>
          </section>
        </div>
      </div>
    </div>
    <Footer></Footer>
  </div>
</template>
<script>
import Indexswiper from "components/mainPage/Indexswiper";
import bannerimg from "components/mainPage/Bannerimg";
import Catewrap from "components/mainPage/Catewrap";
import Footer from 'components/mainPage/Footer'

import Vue from "vue";
import VueAwesomeSwiper from "vue-awesome-swiper";
Vue.use(VueAwesomeSwiper);
import { get } from "utils/http";

export default {
  // name: "listen",
  name: "Indexswiper",
  props:['name'],
   data() {
    return {
      
      moduleData: [],
      num: 0,
      num2:0,
      moreData:[],
      tabData:[],
      swiperOption:{
        autoplay:{
          delay: 1000,
          disableOnInteraction: false,
        },//自动滑动
        spaceBetween:18,
        slidesPerView:'auto',
        centeredSlides:true
      },
      cates:[],
      aa:''
    };
  },
  components: {
    Indexswiper,
    Catewrap,
    bannerimg,
    Footer
  },
  async mounted() {    
    let tabContent = await get({
      url:`/ajax/m-revision/page/index/queryIndexTabContent?moduleKey=${this.name}`
    })
    this.tabData = tabContent.data.moduleContent
    this.cates = tabContent.data.moduleContent.tomatoes
    this.aa = this.tabData.focusImages
    let result = await get({
      url:
        `/ajax/m-revision/page/index/queryIndexCategoryTabContent?moduleKey=${this.name}`
    });
    this.moduleData = result.data.moduleContent.moduleRankDatas;

    for (var i = 0; i < this.moduleData.length; i++) {
      for (
        var j = 0;
        j < this.moduleData[i].albumBriefDetailInfos.length;
        j++
      ) {
        this.num = this.moduleData[i].albumBriefDetailInfos[
          j
        ].statCountInfo.playCount;
        if (this.num > 100000000) {
          this.moduleData[i].albumBriefDetailInfos[j].statCountInfo.playCount =
            Math.floor((this.num / 100000000) * 100) / 100 + "亿";
        } else {
          this.moduleData[i].albumBriefDetailInfos[j].statCountInfo.playCount =
            (this.num / 10000).toFixed(2) + "万";
        }
      }
    }
    let moreRecommend = await get({
      url:`/ajax/m-revision/page/index/queryCategoryFeed?moduleKey=${this.name}`
    })
    this.moreData = moreRecommend.data.materials
    for (var k = 0; k < this.moreData.length; k++) {
     
        this.num2 = this.moreData[k].data.statCountInfo.playCount;
        if (this.num2 > 100000000) {
          this.moreData[k].data.statCountInfo.playCount =
            Math.floor((this.num2 / 100000000) * 100) / 100 + "亿";
        } else {
          this.moreData[k].data.statCountInfo.playCount =
            (this.num2 / 10000).toFixed(2) + "万";
        }
      
    }
    
    
    
  },
  methods:{
    handleClick(id){
      let rs = /\d+/g;
      let idd = id.match(rs)[0]
      console.log(idd);
      this.$router.push(`/detail/${idd}`)
    },
    detailClick(id){
      this.$router.push(`/detail/${id}`)
      // console.log(id);
      
    }
  }

};
</script>
<style lang="stylus" scoped>
.cate-wrap._UQg {
  margin: 30px auto 0 !important;
}
.bottom-list
  padding-bottom 15px

.swiper{
        width:100%;
        height:126px;
    }
    .banner {
        height: 100%;
    }
    .banner .swiper-slide {
        width: 293px;
        height: 126px;
        
    }
    .banner .swiper-slide-next,.banner .swiper-slide-prev{
        top:3px;
    }
    .swiper-slide img{
        width: 100%;
        height:100%
        border-radius:10px;
    }
    .banner .swiper-slide-active{
        width: 293px;
        height: 126px;
        top:0;
    }
    .banner .swiper-slide-active img{
        width: 100%;
        height:100%
    }
    .banner.swiper-container-horizontal>.swiper-pagination-bullets,
    .swiper-pagination-custom,
    .swiper-pagination-fraction {
        bottom: .24rem;
    }
    
    .banner.swiper-container-horizontal>.swiper-pagination-bullets .swiper-pagination-bullet {
        margin: 0 .06rem;
    }
    
    .banner .swiper-pagination-bullet {
        width: 6px;
        height: 6px;
        opacity: 1;
        background: #888888;
    }
    
    .banner .swiper-pagination-bullet-active {
        background: #C71045;
    }
.swiperc
  height 0
</style>